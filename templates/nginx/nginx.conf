  server {
    listen 80;

    # Root directory where the built frontend (HTML/CSS/JS) files are located
    root /usr/share/nginx/html;

    # Default file to serve
    index index.html;

    # Gzip compression
    gzip on;
    gzip_comp_level 5;      # Compression on level 1–9 (5 = sweet spot)
    gzip_min_length 1024;   # Do not compress very small files
    gzip_vary on;           # Add header Vary: Accept-Encoding

    # MIME types
    gzip_types
      text/plain
      text/css
      application/javascript
      application/json
      application/xml
      text/xml
      image/svg+xml;

    # Cache static assets for a long time (1 year)
    # Good for production builds where filenames include hashes (e.g. main.abc123.js)
    location ~* \.(js|css|png|jpg|jpeg|gif|svg|woff2)$ {
      expires 1y;
      add_header Cache-Control "public, immutable";
      try_files $uri =404;
    }

    # Main frontend route — needed for SPA frameworks (React, Vue, Svelte, etc.)
    # Any unknown route falls back to index.html
    location / {
      try_files $uri /index.html;
    }

    # API reverse proxy — forwards /api/* requests to backend service
    # "backend" should match the service name in docker-compose (or another host)
    location ^~ /api/ {
      # Without trailing slash → keeps /api prefix when forwarding
      rewrite ^/api/(.*)$ /$1 break;
      proxy_pass http://backend:3000;

      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
    }
  }
